sudo: false
language: php

php:
- '5.6'

before_install:

- eval `ssh-agent -s`
- chmod 600 ~/.ssh/config
- openssl aes-256-cbc -K $encrypted_d0314f8d1fda_key -iv $encrypted_d0314f8d1fda_iv -in travis.pem.enc -out travis_key -d
- cp travis_key ~/.ssh/
- chmod 600 ~/.ssh/travis_key
- ssh-add ~/.ssh/travis_key

before_script:
- travis_retry composer self-update
- travis_retry composer install --no-interaction --prefer-source --no-progress --no-suggest

branches:
  only:
  - master

cache:
  directories: vendor

script:
- vendor/bin/phpunit

after_success:
- 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then ssh -t -p $DEPLOY_PORT -i ~/.ssh/travis_key -o UserKnownHostsFile=/dev/null -o CheckHostIP=no -o StrictHostKeyChecking=no $DEPLOY_USER@$DEPLOY_HOST "cd $DEPLOY_PATH;bash -s" < deploy.sh; fi'
